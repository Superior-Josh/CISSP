## 7.1 非对称密码
### 7.1.3 Elgamal
- 加密的任何消息都被加长一倍。

### 7.1.4 椭圆曲线
- 3072位 RSA 密钥在密码强度上等同于 256 为椭圆曲线密码系统密钥。

## 7.2 哈希哈数
### 7.2.1 SHA

### 7.2.2 MD5

### 7.2.3 RIPEMD
- RIPEMD 不安全
- RIPEMD-128 不安全
- RIPEMD-160 安全

### 7.2.4 各种哈希算法的哈希值长度比较
| 名称 | 哈希值长度 |
|---|---|
|HAVAL|128、160、192、224、256|
|HMAC|可变|
|MD5|128|
|SHA-1|160|
|SHA-2-224/SHA3-224|224|
|SHA-2-256/SHA3-256|256|
|SHA-2-384/SHA3-384|384|
|SHA-2-512/SHA3-512|512|
|RIPEMD-128|128|
|PIPEMD-160|160|
|RIPEMD-256|256(但是安全强度等于128位)|
|RIPEMD-320|320(但是安全强度等于160位)|

## 7.3 数字签名
$S(m) = E_{SK}(H(m))$

### 7.3.1 HMAC
- 不提供不可否认性。

### 7.3.2 数字签名标准(DSS)
- 数字签名算法(DSA)：ElGamal 的变体
- RSA
- 椭圆曲线 DSA(ECDSA)

## 7.4 公钥基础设施
### 7.4.1 证书
符合 X.509 的证书包含以下数据：
- 证书遵守的 X.509 版本
- 序号(证书创建者编制)
- 签名算法标识符(规定了发证机构给证书内容数字签名时采用的技术)
- 发证者名称
- 有效期
- 主体名称(内含证书的普通名称 CN 以及拥有证书所含公钥的实体的可识别名 DN)
- 主体的公钥

### 7.4.2 发证机构
- 注册机构(RA)分担了 CA 签发数字证书前验证用户身份的工作

$S(cert) = E_{SK_{CA}}(H(cert))$

### 7.4.3 证书的生命周期
1. 注册
2. 验证
3. 注销(revoke)
    - 原因：
      - 证书失信
      - 证书误发
      - 证书细节更改
      - 安全关联变更(例如，主体不再被申请证书的机构雇佣)
    - 验证证书的真实性并识别被注销的证书
      - 证书注销列表(CRL)
        - 内含 CA 签发和注销的证书序号，以及注销的生效日期和时间
        - 缺点：用户必须定期下载 CRL 并交叉查对，这在证书注销的时间与最终用户得知注销的时间之间产生了一个滞后期
      - 在线证书状态协议(OCSP)
        - 客户端收到一份证书后可向 CA 的 OCSP 发送一个请求，服务器随后把该证书的有效、无效或未知状态回复给客户端
        - 缺点：给由 CA 运行的 OCSP 服务器带来极大的负担 
      - 证书装订
        - OCSP 的扩展：由服务器代替客户端去查询 OCSP 响应，并将该响应“装订”在 TLS 握手过程中一并发送给客户端。

### 7.4.4 证书的格式

|标准|格式|文件扩展名|
|---|---|---|
|区分编码规则(DER)|二进制|.der、.crt、.cer|
|隐私增强邮件(PEM)|文本|.pem、.crt|
|个人信息交换(PFX)|二进制|.pfx、.p12|
|P7B|文本|.p7b|

## 7.5 非对称密钥管理
- 挑选加密系统要理智审慎
- 以合适的方式挑选密钥
- 若使用公钥加密，务必为私钥严格保密
- 密钥完成使命后要退役
- 必须备份密钥
- 硬件安全模块

## 7.7 应用密码学
### 7.7.1 便携设备
- Windows: Bitlocker, Encrypting File System(EFS)
- macOS: FileVault
- Linux: LUKS

- VeraCrypt 可用来在 Linux、Windows、macOS 系统上给硬盘加密
- TPM 可保存和管理用于全硬盘加密(FDE)解决方案的密钥

### 7.7.2 电子邮件
1. 良好隐私(Pretty Good Privacy, PGP)
   - 场景：Alice 向 Bob 发送一条加密且签名的消息
     1. 步骤 1：准备消息
        - Alice 写好明文消息 M。
     2. 步骤 2：签名（可选但推荐）
        - Alice 对 M 计算哈希 H = Hash(M)。
        - 用她的私钥加密 H → 得到数字签名 S。
        - 将 M 和 S 组合。
     3. 步骤 3：压缩
        - 对（M + S）进行压缩 → C。
     4. 步骤 4：对称加密
        - 随机生成一个会话密钥 K（如 256 位 AES 密钥）。
        - 用 K 加密压缩后的数据 C → 密文 E。
     5. 步骤 5：加密会话密钥
        - 用 Bob 的公钥加密会话密钥 K → 加密后的 K'。
     6. 步骤 6：打包并编码
        - 将 E 和 K' 打包，可选地进行 Radix-64 编码 → 最终 PGP 消息。
     7. Bob 收到后解密：
        - 用他的私钥解密 K' → 得到会话密钥 K。
        - 用 K 解密 E → 得到压缩数据 C。
        - 解压 C → 得到（M + S）。
        - 用 Alice 的公钥验证签名 S → 确认消息来自 Alice 且未被篡改。

2. S/MIME
  - 使用 RSA 加密算法
  - S/MIME 通过 X.509 证书交换加密密钥。这些证书包含的公钥用于数字签名和交换对称密钥，而这些对称密钥将用于较长的通信会话
  - 用户若想用 S/MIME 保证保密性或想自己创建有数字签名的消息，则必须得到自己的证书
  - 基于 Web 的主流邮件系统并不支持

### 7.7.3 Web应用
2. **传输层安全(TLS)**
   - 密码套件由四个成分组成
     - 用于交换临时密钥的密钥交换算法：RSA、DH、ECDH
     - 用于证明服务器和/或客户端身份的身份认证算法：RSA、DSA、ECDSA
     - 用于对称加密的批量加密算法：AES、3DES
     - 用于创建消息摘要的哈希算法：SHA
3. **洋葱网(Tor)和暗网**
   - 完全前向保密(perfect forward secrecy, PFS)

### 7.7.5 联网
1. 线路加密
   - **链路加密(link encryption)**：通过使用硬件或软件解决方案在两点之间创建一条安全隧道来保护整个通信线路
     - 所有数据(包括消息包头、消息尾部、地址和路由数据)都是被加密的
     - 每个数据包必须在每个中继段进行解密，然后重新加密，才能正常进入下一个中继段继续发送，这减慢了路由的速度 
   - **端到端加密(end-to-end encryption)**：独立于链路加密执行，保护通信双方之间的通信
     - 不给包头、尾部、地址和路由数据加密
     - 传送速度更快，但面嗅探者和窃听者时会更脆弱
2. IPsec
   - 依靠安全关联，其中包含两个主要成分：
     - **身份认证头(AH)**：为消息的完整性和不可否认性提供保障。还提供身份认证和访问控制，可抵御重放攻击
     - **封装安全载荷(ESP)**：为消息的保密性和完整性提供保障。还提供加密和有限的身份认证，也可抵御重放攻击
   - 可在两种离散模式下运行：
     - 传输模式(transport mode)：
       - 用于端到端加密时，只加密数据包载荷
       - 为对等通信设计
     - 隧道模式(tunnel mode)
       - 加密包括报头在内的整个数据包
       - 为链路加密设计
   - 通过创建安全关联(security association, SA)来建立 IPsec 会话
     - SA 代表通信会话，记录了有关连接的所有配置和状态信息
     - 若想建立一条双向信道，需要建立两个 SA，两个方向各用一个
   - 优势：存在安全关联的客户端或网关(无论它们使用哪些协议或服务)只要能够使用 IPsec 连接，就能受到严格管理
     - 没有明确定义有限安全关联的情况下，成对的用户或网关之间将不能建立 IPsec 链路

### 7.7.6 新兴的应用
1. **区块链**：分布式不可变公共分类账
3. **同态加密**：为数据加密后保留了对数据进行计算的能力

### 7.8 密码攻击
- **实现攻击**：探寻密码系统在执行过程中暴露的弱点的攻击。着重于挖掘软件代码，不仅包括错误和缺陷，还涉及用来给加密系统编程的方法
- **暴力破解**
  - 彩虹表
  - 专为暴力破解攻击设计的可扩展计算硬件
  - 加盐保护口令：$H(passwd|salt)|salt$